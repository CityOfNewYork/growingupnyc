!function(p,l){"use strict";var f={},e=p(document.body);f.search_id=function(e){var t=void 0;return void 0!==e.id?t=e.id:void 0!==e.ID?t=e.ID:void 0!==e.value&&(t=e.value),void 0===e?void 0:t},f.calendar_toggle=function(e){e.find(".calendar-widget-filters-title").hide(),e.find(".calendar-widget-filters-operand").hide();var t=e.find(".calendar-widget-added-filters");if(t.length){var a=t.val()?jQuery.parseJSON(t.val()):new Object,i=0;for(var n in a)i+=a[n].length;0<i&&(e.find(".calendar-widget-filters-title").show(),1<i&&e.find(".calendar-widget-filters-operand").show())}},f.select2=function(){var a=p(this),n={};if(a.hasClass("select2-container")&&a.select2("destroy"),p("body").hasClass("wp-customizer")&&(n.dropdownCssClass="tribe-customizer-select2"),a.is("select")||(n.id=f.search_id),n.allowClear=!0,a.is("[data-prevent-clear]")&&(n.allowClear=!1),a.is("[data-options]")&&(n.data=a.data("options")),a.is("[data-hide-search]")&&(n.minimumResultsForSearch=1/0),a.is("[multiple]")&&(n.multiple=!0,l.isArray(a.data("separator"))?n.tokenSeparators=a.data("separator"):n.tokenSeparators=[a.data("separator")],n.separator=a.data("separator"),n.regexSeparatorElements=["^("],n.regexSplitElements=["(?:"],p.each(n.tokenSeparators,function(e,t){n.regexSeparatorElements.push("[^"+t+"]+"),n.regexSplitElements.push("["+t+"]")}),n.regexSeparatorElements.push(")$"),n.regexSplitElements.push(")"),n.regexSeparatorString=n.regexSeparatorElements.join(""),n.regexSplitString=n.regexSplitElements.join(""),n.regexToken=new RegExp(n.regexSeparatorString,"ig"),n.regexSplit=new RegExp(n.regexSplitString,"ig")),n.matcher=function(e,t){var a=0==t.toUpperCase().indexOf(e.toUpperCase());if(!a&&void 0!==n.tags){var i=l.where(n.tags,{text:t});if(0<n.tags.length&&l.isObject(i))a=0==obj.search_id(i[0]).toUpperCase().indexOf(e.toUpperCase())}return a},a.is("[data-tags]")&&(n.tags=a.data("options"),n.initSelection=function(e,t){var a=[];p(e.val().split(n.regexSplit)).each(function(){var e={id:this,text:this};if(0<n.tags.length&&l.isObject(n.tags[0])){var t=l.where(n.tags,{value:this});0<t.length&&(e={id:(e=t[0]).value,text:e.text})}a.push(e)}),t(a)},n.createSearchChoice=function(e,t){if(e.match(n.regexToken))return{id:e,text:e}},0===n.tags.length&&(n.formatNoMatches=function(){return a.attr("placeholder")})),a.is("[data-source]")){var i=a.data("source");n.data={results:[]},n.escapeMarkup=function(e){return e},n.ajax={dataType:"json",type:"POST",url:window.ajaxurl,results:function(e){return e.data}},n.ajax.data=function(e,t){return{action:"tribe_widget_dropdown_"+i,disabled:a.data("disabled"),search:e,page:t}}}a.on("open",function(){p(".select2-drop").css("z-index",1e7)}).select2(n)},f.conditional=function(e,t){var a=p(e),i=a.data("tribeConditionalField"),n=t.find(".js-tribe-conditional").filter('[data-tribe-conditional-field="'+i+'"]'),r=a.val();n.hide().each(function(){var e=p(this);e.hasClass("tribe-select2")&&e.prev(".select2-container").hide()}).filter('[data-tribe-conditional-value="'+r+'"]').show().each(function(){var e=p(this);e.hasClass("tribe-select2")&&e.hide().prev(".select2-container").show()})},f.setup=function(e,t){if(void 0===t){var a=p(e.target);if(!a.parents(".widget-top").length||a.parents("#available-widgets").length)return;t=a.closest("div.widget")}"object"==typeof t&&(t=p(t)),"jQuery"!=typeof t&&(t.is('[id*="tribe-"]')||!t.is(".so-content.panel-dialog")||t.find('[id^="widget-tribe-events-"]'))&&(t.is('[id*="__i__"]')||(t.find(".tribe-widget-select2").each(f.select2).trigger("change.select2"),t.on("change",".js-tribe-condition",function(){f.conditional(this,t)}),p("body").hasClass("wp-customizer")||(p.isNumeric(e)||"widget-updated"===e.type)&&t.find(".js-tribe-condition").each(function(){f.conditional(this,t)})))},p(document).ready(function(e){p("body").hasClass("wp-customizer")||p('.widget[id*="tribe-"]').each(f.setup)}).on({"widget-added widget-updated":f.setup}).on("change",".calendar-widget-add-filter",function(e){var t=p(this),a=t.parents('.widget[id*="tribe-"]'),i=a.find(".calendar-widget-filters-container"),n=a.find(".calendar-widget-filter-list"),r=a.find(".calendar-widget-added-filters"),d=r.val()?p.parseJSON(r.val()):{},s=e.added,o=t.data("disabled")?t.data("disabled"):[];if(void 0!==s)if(d[s.taxonomy.name]||(d[s.taxonomy.name]=[]),-1===p.inArray(s.id,d[s.taxonomy.name])){i.show(),d[s.taxonomy.name].push(s.id),r.val(JSON.stringify(d));var l=p("<a/>").attr({"data-tax":s.taxonomy.name,"data-term":s.id,class:"calendar-widget-remove-filter",href:"#"}).text("(remove)"),c=p("<span/>").append(l),g=p("<li/>").append("p").html(s.taxonomy.labels.name+": "+s.text).append(c);n.append(g),f.calendar_toggle(a),o.push(s.id),t.data("disabled",o),t.select2("val","",!1)}else t.select2("val","",!1)}).on("click",".calendar-widget-remove-filter",function(e){e.preventDefault();var t=p(this),a=t.parents('.widget[id*="tribe-"]'),i=a.find(".calendar-widget-add-filter").not(".select2-container"),n=(a.find(".calendar-widget-filters-container"),a.find(".calendar-widget-filter-list"),a.find(".calendar-widget-added-filters")),r=n.val()?p.parseJSON(n.val()):{},d=t.data("term"),s=t.data("tax"),o=i.data("disabled")?i.data("disabled"):[];r[s]&&(r[s]=l.without(r[s],d.toString())),n.val(JSON.stringify(r)),i.data("disabled",l.without(o,d.toString())),t.closest("li").remove(),a.find('input[name^="widget-tribe-"]').trigger("change"),f.calendar_toggle(a)}).on("click",".so-close",function(e){p(".calendar-widget-add-filter").select2("close")}),e.on("click.widgets-toggle",f.setup),p(document).on("panelsopen",function(a){p(".so-content.panel-dialog").each(function(){var e=p(this);if(!e.hasClass("widget")){var t=e.find('[id^="widget-tribe-"]').filter('[id$="-title"]').attr("id");if(!t)return;t=t.substring(0,t.indexOf("-title")),e.attr("id",t).addClass("widget"),f.setup(a,e),p(".so-duplicate").on("click",function(e){p(".calendar-widget-add-filter").select2("close")}),p(".so-delete").on("click",function(e){p(".calendar-widget-add-filter").select2("close")})}})})}(jQuery.noConflict(),_);