!function(j,y,L,k,T,P,E,B,D,O,G){if(null!==TribeEventsPro.geocenter.max_lat){L.extend(tribe_ev.fn,{map_add_marker:function(e,t,r,a,i){if("undefined"!=typeof google){var o=new google.maps.LatLng(e,t),n={position:o,map:E.map,title:r};"undefined"!==GeoLoc.pin_url&&GeoLoc.pin_url&&(n.icon=GeoLoc.pin_url),n=new google.maps.Marker(n);var s=new google.maps.InfoWindow,p=r;i&&(p=L("<div/>").append(L("<a/>").attr("href",i).text(r)).html());var g=TribeEventsPro.map_tooltip_event+p;a&&(g=g+"<br/>"+TribeEventsPro.map_tooltip_address+a),s.setContent(g),google.maps.event.addListener(n,"click",function(e){s.open(E.map,n)}),E.markers.push(n),E.refine&&n.setVisible(!1),E.bounds.extend(o)}}});try{E.geocoder=new google.maps.Geocoder,E.bounds=new google.maps.LatLngBounds}catch(e){}L(y).ready(function(){var e=L("#tribe-bar-geoloc"),t=L("#tribe_events_filter_item_geofence"),r=L("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng");function a(){e.length&&(e.val()?t.show():(t.hide(),r.length&&r.val("")))}L("#tribe-bar-geoloc").on("keydown keyup",function(e){t.toggle(""!==this.value.trim())}),a();var o,n=L("#tribe-events"),s=L("#tribe-bar-geoloc"),p=L("#tribe-geo-options"),g=!1,l=y.getElementById("tribe-geo-map");if(l&&"undefined"!=typeof google){var b={zoom:5,center:new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng),mapTypeId:google.maps.MapTypeId.ROADMAP};E.map=new google.maps.Map(l,b),E.bounds=new google.maps.LatLngBounds,L("body").trigger("map-created.tribe",[E.map,l,b,E.bounds]);var _=new google.maps.LatLng(TribeEventsPro.geocenter.min_lat,TribeEventsPro.geocenter.min_lng);E.bounds.extend(_);var d=new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng);E.bounds.extend(d)}if(L().placeholder&&L("#tribe-geo-location").placeholder(),D.map_view()){var c=P.get_url_param("tribe_paged"),v=P.get_url_param("tribe_event_display");c&&(B.paged=c),B.view="map","past"==v&&(B.view="past"),P.tooltips()}if(D.map_view()&&k.params){var m=k.params;0<=P.in_params(m,"tribe_geosearch")||(m+="&action=tribe_geosearch"),0<=P.in_params(m,"tribe_paged")||(m+="&tribe_paged=1"),B.params=m,B.do_string=!1,B.pushstate=!1,B.popping=!0,P.pre_ajax(function(){f()})}else D.map_view()&&(B.do_string=!1,B.pushstate=!1,B.popping=!1,B.initial_load=!0,P.pre_ajax(function(){f()}));function u(){if(B.ajax_running=!0,B.params={action:"tribe_geosearch",tribe_paged:B.paged,tribe_event_display:B.view,featured:P.is_featured()},B.category&&(B.params.tribe_event_category=B.category),k.default_permalinks&&(B.params.hasOwnProperty("post_type")||(B.params.post_type=O.events_post_type),B.params.hasOwnProperty("eventDisplay")||(B.params.eventDisplay="map")),L(T).trigger("tribe_ev_serializeBar"),L(T).trigger("serialize-bar.tribe"),P.invalid_date_in_params(B.params))return B.ajax_running=!1,void(g=!0);g=!1,B.params=L.param(B.params),L(T).trigger("tribe_ev_collectParams"),L(T).trigger("collect-params.tribe")}function f(){B.popping||(u(),B.pushstate=!1,B.initial_load||(B.do_string=!0)),g||(L("#tribe-events-content .tribe-events-loop").tribe_spin(),w(),L.post(GeoLoc.ajaxurl,B.params,function(e){if(L(T).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_mapView_AjaxStart"),L(T).trigger("ajax-start.tribe").trigger("map-view-ajax-start.tribe"),P.enable_inputs("#tribe_events_filters_form","input, select"),e.success){B.ajax_running=!1,k.ajax_response={total_count:parseInt(e.total_count),view:e.view,max_pages:e.max_pages,tribe_paged:e.tribe_paged,timestamp:(new Date).getTime()},B.initial_load=!1;var t=L.parseHTML(e.html);if(L("#tribe-events-content").replaceWith(t),0==e.total_count&&L("#tribe-events-header").hide(),L.each(e.markers,function(e,t){P.map_add_marker(t.lat,t.lng,t.title,t.address,t.link)}),D.pushstate){if(B.page_title=L("#tribe-events-header").data("title"),B.view_title=L("#tribe-events-header").data("viewtitle"),y.title=B.page_title,L(".tribe-events-page-title").html(B.view_title),B.do_string){var r=B.params.replace(/&?baseurl=[^&]*/i,"");history.pushState({tribe_paged:B.paged,tribe_params:B.params},B.page_title,k.cur_url+"?"+r)}B.pushstate&&history.pushState({tribe_paged:B.paged,tribe_params:B.params},B.page_title,k.cur_url)}L(T).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_mapView_AjaxSuccess"),L(T).trigger("ajax-success.tribe").trigger("map-view-ajax-success.tribe"),0<e.markers.length&&h()}}))}(D.pushstate&&D.map_view()&&(history.replaceState({tribe_paged:B.paged,tribe_params:B.params},"",location.href),L(j).on("popstate",function(e){var t=e.originalEvent.state;t&&(B.do_string=!1,B.pushstate=!1,B.popping=!0,B.params=t.tribe_params,B.paged=t.tribe_paged,P.pre_ajax(function(){f()}),P.set_form(B.params))})),D.map_view()&&(n.on("click",".tribe-geo-option-link",function(e){e.preventDefault(),e.stopPropagation();var t=L(this);L(".tribe-geo-option-link").removeClass("tribe-option-loaded"),t.addClass("tribe-option-loaded"),s.val(t.text()),L("#tribe-bar-geoloc-lat").val(E.geocodes[t.data("index")].geometry.location.lat()),L("#tribe-bar-geoloc-lng").val(E.geocodes[t.data("index")].geometry.location.lng()),B.do_string=!0,B.pushstate=!1,B.popping=!1,D.pushstate?P.pre_ajax(function(){f(),p.hide()}):P.pre_ajax(function(){L(T).trigger("tribe_ev_reloadOldBrowser"),L(T).trigger("reload-old-browser.tribe")})}),L(y).on("click",function(){p.hide()}),P.snap("#tribe-events-content-wrapper","#tribe-events-content-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a")),L(T).on("reload-old-browser.tribe",function(){u(),j.location=k.cur_url+"?"+B.params}),D.map_view())&&(L("#tribe-geo-map-wrapper").resize(function(){o=E.map.getCenter(),google.maps.event.trigger(E.map,"resize"),E.map.setCenter(o)}),L("#tribe-events").on("click","li.tribe-events-nav-next a",function(e){e.preventDefault(),B.ajax_running||("past"===B.view?"1"==B.paged?B.view="map":B.paged--:B.paged++,B.popping=!1,D.pushstate?P.pre_ajax(function(){f()}):P.pre_ajax(function(){L(T).trigger("tribe_ev_reloadOldBrowser"),L(T).trigger("reload-old-browser.tribe")}))}).on("click","li.tribe-events-nav-previous a",function(e){e.preventDefault(),B.ajax_running||("map"===B.view?"1"==B.paged?B.view="past":B.paged--:B.paged++,B.popping=!1,D.pushstate?P.pre_ajax(function(){f()}):P.pre_ajax(function(){L(T).trigger("tribe_ev_reloadOldBrowser"),L(T).trigger("reload-old-browser.tribe")}))}));function w(){if(E.markers&&"undefined"!=typeof google){for(i in E.markers)E.markers[i].setMap(null);E.markers.length=0,E.bounds=new google.maps.LatLngBounds}}function h(){"undefined"!=typeof google&&(E.map.fitBounds(E.bounds),13<E.map.getZoom()&&E.map.setZoom(13))}function x(){L("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").hide()}(GeoLoc.map_view&&L("form#tribe-bar-form").length&&D.live_ajax()&&D.pushstate||GeoLoc.map_view&&D.no_bar())&&L("#tribe-events-bar").on("changeDate","#tribe-bar-date",function(e){!function(e){if("change_view"!=tribe_events_bar_action){if(e.preventDefault(),B.ajax_running)return;B.paged=1,B.view="map",B.popping=!1,D.pushstate?P.pre_ajax(function(){f()}):P.pre_ajax(function(){L(T).trigger("tribe_ev_reloadOldBrowser"),L(T).trigger("reload-old-browser.tribe")})}}(e)}),GeoLoc.map_view&&L(T).on("run-ajax.tribe",function(){f()}),D.map_view()&&(L("form#tribe-bar-form").on("submit",function(){if("change_view"!=tribe_events_bar_action){B.paged=1,L("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").show(),L(".tribe-events-sub-nav").remove();var e=L("#tribe-bar-geoloc").val();return""!==e?(B.do_string=!0,B.pushstate=!1,B.popping=!1,w(),L("#tribe-geo-results").empty(),L("#tribe-geo-options").hide(),L("#tribe-geo-options #tribe-geo-links").empty(),P.process_geocoding(e,function(e){E.geocodes=e,x();var t=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();t&&L("#tribe-bar-geoloc-lat").val(t),r&&L("#tribe-bar-geoloc-lng").val(r),1<E.geocodes.length?(P.print_geo_options(),a(),h()):D.pushstate?(a(),f(E.geocodes[0])):(L(T).trigger("tribe_ev_reloadOldBrowser"),L(T).trigger("reload-old-browser.tribe"))}),!1):""!==e||(L("#tribe-bar-geoloc-lat").val(""),L("#tribe-bar-geoloc-lng").val(""),L("#tribe-geo-options").hide(),D.pushstate?(B.do_string=!0,B.pushstate=!1,B.popping=!1,a(),f()):(L(T).trigger("tribe_ev_reloadOldBrowser"),L(T).trigger("reload-old-browser.tribe")),x(),!1)}}),B.view&&G&&tec_debug.timeEnd("Tribe JS Init Timer")),G&&tec_debug.info("TEC Debug: tribe-events-ajax-maps.js successfully loaded")})}}(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests,tribe_js_config,tribe_debug);